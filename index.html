<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a202c">
    <meta name="description" content="MRT-LAND - Jeu d'arcade mobile">
    <title>MRT-LAND</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #111827;
            overflow: hidden;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 8px;
        }
        #game-box {
            background: #1f2937;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 448px;
        }
        h1 {
            color: #fbbf24;
            font-size: 1.875rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 12px;
        }
        #stats {
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 0.875rem;
            font-weight: bold;
            padding: 0 8px;
            margin-bottom: 12px;
        }
        #canvas-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 12px;
        }
        canvas {
            border: 4px solid #2563eb;
            border-radius: 4px;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        #message {
            text-align: center;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 12px;
        }
        .level-complete {
            background: #064e3b;
        }
        .game-over {
            background: #7f1d1d;
        }
        .instructions {
            background: #374151;
            font-size: 0.875rem;
        }
        .message-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .message-text {
            margin-bottom: 8px;
        }
        button {
            width: 100%;
            padding: 12px 24px;
            font-size: 1.25rem;
            font-weight: bold;
            color: white;
            background: #22c55e;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 12px;
        }
        button:hover {
            background: #16a34a;
        }
        button:active {
            background: #15803d;
        }
        #controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            max-width: 320px;
            margin: 0 auto 8px;
        }
        .control-btn {
            width: 100%;
            padding: 16px 24px;
            font-size: 1.5rem;
            background: #3b82f6;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        .control-btn:active {
            background: #1d4ed8;
        }
        .empty-cell {
            grid-column: span 1;
        }
        #footer {
            text-align: center;
            color: #6b7280;
            font-size: 0.75rem;
            margin-top: 8px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-box">
            <h1>MRT - LAND</h1>
            
            <div id="stats">
                <div>üí∞ <span id="score">0</span></div>
                <div>üéØ Niv.<span id="level">1</span></div>
                <div id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
            </div>

            <div id="canvas-wrapper">
                <canvas id="gameCanvas" width="300" height="300"></canvas>
            </div>

            <div id="message" class="hidden"></div>

            <button id="startBtn">‚ñ∂Ô∏è JOUER</button>

            <div id="controls">
                <div class="empty-cell"></div>
                <button class="control-btn" data-dir="up">‚ñ≤</button>
                <div class="empty-cell"></div>
                <button class="control-btn" data-dir="left">‚óÑ</button>
                <div class="empty-cell"></div>
                <button class="control-btn" data-dir="right">‚ñ∫</button>
                <div class="empty-cell"></div>
                <button class="control-btn" data-dir="down">‚ñº</button>
                <div class="empty-cell"></div>
            </div>

            <div id="footer">Collectez tous les points pour avancer! üéØ</div>
        </div>
    </div>

    <script>
        const CELL_SIZE = 20;
        const GRID_WIDTH = 15;
        const GRID_HEIGHT = 15;

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');
        const livesEl = document.getElementById('lives');
        const messageEl = document.getElementById('message');
        const startBtn = document.getElementById('startBtn');

        const mazes = [
            // Niveau 1 - D√©butant
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,0,1,1,0,1,0,1,0,1,0,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,1,1,1,0,1,1,1,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,0,1,0,1,0,1,0,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,0,1,1,1,1,1,0,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,1,1,0,1,0,1,1,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,0,1,0,1,0,1,0,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Niveau 2 - Facile
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,1,1,1,1,1,1,1,0,1,0,1],[1,0,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,1,1,0,1,1,0,1,0,1,1,0,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,0,1,1,1,1,1,0,1,1,0,1],[1,0,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,0,1,0,1,1,0,1,0,1,1,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Niveau 3 - Moyen
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,1,1,1,1,0,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,0,1,0,1,1,1,0,1,0,1,1,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,0,1,1,1,1,1,0,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,1,1,1,1,1,1,1,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Niveau 4 - Moyen+
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,1,1,1,1,1,1,1,0,1,0,1],[1,0,1,0,0,0,0,1,0,0,0,0,1,0,1],[1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],[1,0,1,0,0,0,0,1,0,0,0,0,1,0,1],[1,0,1,0,1,1,1,1,1,1,1,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Niveau 5 - Difficile
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,0,1,0,1,1,1,0,1,1,1,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,1,1,0,1,1,1,0,1,1,1,0,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,0,1,1,1,0,1,1,1,0,1,1,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,1,1,1,0,1,1,1,0,1,0,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Niveau 6 - Difficile+
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,1,1,1,1,1,1,1,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,1,1,1,1,1,1,1,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Niveau 7 - Expert
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],[1,0,1,0,1,0,0,0,0,0,1,0,1,0,1],[1,0,1,0,1,1,1,0,1,1,1,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,0,1,1,1,0,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,0,1,1,1,0,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,1,1,1,0,1,1,1,0,1,0,1],[1,0,1,0,1,0,0,0,0,0,1,0,1,0,1],[1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Niveau 8 - Expert+
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,0,1,1,1,1,1,0,1,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,1,1,0,1,0,1,1,0,1,0,1],[1,0,0,0,1,0,0,1,0,0,1,0,0,0,1],[1,1,1,1,1,0,1,1,1,0,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,0,1,1,1,0,1,1,1,1,1],[1,0,0,0,1,0,0,1,0,0,1,0,0,0,1],[1,0,1,0,1,1,0,1,0,1,1,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,1,0,1,1,1,1,1,0,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Niveau 9 - Ma√Ætre
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],[1,0,1,0,0,0,1,0,1,0,0,0,1,0,1],[1,0,1,1,1,1,1,0,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,1,0,1,1,1,1,1,0,1],[1,0,1,0,0,0,1,0,1,0,0,0,1,0,1],[1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
            // Niveau 10 - BOSS Final
            [[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,1,0,1,1,1,1,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,1,1,1,1,1,1,1,0,1,0,1],[1,0,1,0,1,0,0,0,0,0,1,0,1,0,1],[1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],[1,0,0,0,0,0,1,0,1,0,0,0,0,0,1],[1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],[1,0,1,0,1,0,0,0,0,0,1,0,1,0,1],[1,0,1,0,1,1,1,1,1,1,1,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,1,1,1,1,0,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]
        ];

        let gameState = {
            pacman: {x: 1, y: 1, direction: 'right', nextDirection: 'right'},
            ghosts: [],
            dots: [],
            powerPellets: [],
            score: 0,
            level: 1,
            lives: 3,
            ghostSpeed: 250,
            powerMode: false,
            powerModeTimer: 0,
            gameStarted: false,
            gameOver: false,
            levelComplete: false,
            gameLoop: null
        };

        function initLevel(levelNum) {
            const maze = mazes[Math.min(levelNum - 1, mazes.length - 1)];
            gameState.dots = [];
            gameState.powerPellets = [];
            
            for (let y = 0; y < GRID_HEIGHT; y++) {
                for (let x = 0; x < GRID_WIDTH; x++) {
                    if (maze[y][x] === 0) {
                        if ((x === 1 && y === 1) || (x === 13 && y === 1) || (x === 1 && y === 13) || (x === 13 && y === 13)) {
                            gameState.powerPellets.push({x, y, eaten: false});
                        } else {
                            gameState.dots.push({x, y, eaten: false});
                        }
                    }
                }
            }

            const numGhosts = Math.min(2 + Math.floor(levelNum / 2), 8);
            gameState.ghostSpeed = Math.max(250 - (levelNum - 1) * 15, 100);
            
            gameState.ghosts = [];
            const startPositions = [{x:13,y:1},{x:1,y:13},{x:13,y:13},{x:7,y:7},{x:3,y:3},{x:11,y:11},{x:5,y:5},{x:9,y:9}];
            
            for (let i = 0; i < numGhosts; i++) {
                gameState.ghosts.push({
                    ...startPositions[i],
                    direction: ['left','right','up','down'][Math.floor(Math.random()*4)]
                });
            }

            gameState.pacman = {x: 1, y: 1, direction: 'right', nextDirection: 'right'};
            gameState.level = levelNum;
        }

        function drawGame() {
            const maze = mazes[Math.min(gameState.level - 1, mazes.length - 1)];
            
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const colors = ['#0000FF', '#8B00FF', '#FF4500', '#00CED1', '#FF1493', '#00FF00', '#FFD700', '#FF69B4', '#FF00FF', '#00FFFF'];
            const wallColor = colors[Math.min(gameState.level - 1, colors.length - 1)];

            for (let y = 0; y < GRID_HEIGHT; y++) {
                for (let x = 0; x < GRID_WIDTH; x++) {
                    if (maze[y][x] === 1) {
                        ctx.fillStyle = wallColor;
                        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                    }
                }
            }

            gameState.dots.forEach(dot => {
                if (!dot.eaten) {
                    ctx.fillStyle = '#FFD700';
                    ctx.beginPath();
                    ctx.arc(dot.x * CELL_SIZE + CELL_SIZE/2, dot.y * CELL_SIZE + CELL_SIZE/2, 2, 0, Math.PI*2);
                    ctx.fill();
                }
            });

            gameState.powerPellets.forEach(pellet => {
                if (!pellet.eaten) {
                    ctx.fillStyle = '#FFF';
                    ctx.beginPath();
                    ctx.arc(pellet.x * CELL_SIZE + CELL_SIZE/2, pellet.y * CELL_SIZE + CELL_SIZE/2, 5, 0, Math.PI*2);
                    ctx.fill();
                }
            });

            ctx.fillStyle = gameState.powerMode ? '#FFD700' : '#FFFF00';
            ctx.beginPath();
            ctx.arc(
                gameState.pacman.x * CELL_SIZE + CELL_SIZE/2,
                gameState.pacman.y * CELL_SIZE + CELL_SIZE/2,
                CELL_SIZE/2 - 2,
                0.2 * Math.PI,
                1.8 * Math.PI
            );
            ctx.lineTo(
                gameState.pacman.x * CELL_SIZE + CELL_SIZE/2,
                gameState.pacman.y * CELL_SIZE + CELL_SIZE/2
            );
            ctx.fill();

            gameState.ghosts.forEach(ghost => {
                const cx = ghost.x * CELL_SIZE + CELL_SIZE/2;
                const cy = ghost.y * CELL_SIZE + CELL_SIZE/2;
                
                ctx.fillStyle = gameState.powerMode ? '#A0522D' : '#654321';
                
                ctx.beginPath();
                ctx.arc(cx, cy + 4, 7, 0, Math.PI*2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(cx - 1, cy + 1, 6, 0, Math.PI*2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(cx, cy - 2, 5, 0, Math.PI*2);
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(cx + 1, cy - 5, 3, 0, Math.PI*2);
                ctx.fill();
                
                if (!gameState.powerMode) {
                    ctx.fillStyle = '#FFF';
                    ctx.beginPath();
                    ctx.arc(cx - 2, cy, 2, 0, Math.PI*2);
                    ctx.arc(cx + 2, cy, 2, 0, Math.PI*2);
                    ctx.fill();
                    
                    ctx.fillStyle = '#000';
                    ctx.beginPath();
                    ctx.arc(cx - 2, cy, 1, 0, Math.PI*2);
                    ctx.arc(cx + 2, cy, 1, 0, Math.PI*2);
                    ctx.fill();
                }
            });
        }

        function updateGame() {
            const maze = mazes[Math.min(gameState.level - 1, mazes.length - 1)];

            if (gameState.powerMode) {
                gameState.powerModeTimer--;
                if (gameState.powerModeTimer <= 0) {
                    gameState.powerMode = false;
                }
            }

            gameState.pacman.direction = gameState.pacman.nextDirection;
            let newX = gameState.pacman.x;
            let newY = gameState.pacman.y;

            switch(gameState.pacman.direction) {
                case 'up': newY--; break;
                case 'down': newY++; break;
                case 'left': newX--; break;
                case 'right': newX++; break;
            }

            if (maze[newY] && maze[newY][newX] === 0) {
                gameState.pacman.x = newX;
                gameState.pacman.y = newY;
            }

            const dotIdx = gameState.dots.findIndex(d => !d.eaten && d.x === gameState.pacman.x && d.y === gameState.pacman.y);
            if (dotIdx !== -1) {
                gameState.dots[dotIdx].eaten = true;
                gameState.score += 10;
                scoreEl.textContent = gameState.score;
            }

            const pelletIdx = gameState.powerPellets.findIndex(p => !p.eaten && p.x === gameState.pacman.x && p.y === gameState.pacman.y);
            if (pelletIdx !== -1) {
                gameState.powerPellets[pelletIdx].eaten = true;
                gameState.score += 50;
                gameState.powerMode = true;
                gameState.powerModeTimer = 50;
                scoreEl.textContent = gameState.score;
            }

            if (gameState.dots.every(d => d.eaten) && gameState.powerPellets.every(p => p.eaten)) {
                stopGame();
                gameState.levelComplete = true;
                showMessage('level-complete');
                return;
            }

            gameState.ghosts.forEach(ghost => {
                const dirs = ['up','down','left','right'];
                const validDirs = dirs.filter(dir => {
                    let tx = ghost.x, ty = ghost.y;
                    switch(dir) {
                        case 'up': ty--; break;
                        case 'down': ty++; break;
                        case 'left': tx--; break;
                        case 'right': tx++; break;
                    }
                    return maze[ty] && maze[ty][tx] === 0;
                });

                if (validDirs.length > 0) {
                    if (Math.random() < 0.3 || !validDirs.includes(ghost.direction)) {
                        ghost.direction = validDirs[Math.floor(Math.random() * validDirs.length)];
                    }
                }

                switch(ghost.direction) {
                    case 'up': ghost.y--; break;
                    case 'down': ghost.y++; break;
                    case 'left': ghost.x--; break;
                    case 'right': ghost.x++; break;
                }

                if (ghost.x === gameState.pacman.x && ghost.y === gameState.pacman.y) {
                    if (gameState.powerMode) {
                        ghost.x = 7;
                        ghost.y = 7;
                        gameState.score += 200;
                        scoreEl.textContent = gameState.score;
                    } else {
                        gameState.lives--;
                        updateLives();
                        if (gameState.lives <= 0) {
                            stopGame();
                            gameState.gameOver = true;
                            showMessage('game-over');
                        } else {
                            gameState.pacman.x = 1;
                            gameState.pacman.y = 1;
                        }
                    }
                }
            });

            drawGame();
        }

        function startGame() {
            gameState.gameStarted = true;
            gameState.gameOver = false;
            gameState.levelComplete = false;
            gameState.score = 0;
            gameState.level = 1;
            gameState.lives = 3;
            
            scoreEl.textContent = '0';
            levelEl.textContent = '1';
            updateLives();
            hideMessage();
            startBtn.classList.add('hidden');
            
            initLevel(1);
            drawGame();
            
            gameState.gameLoop = setInterval(updateGame, gameState.ghostSpeed);
        }

        function stopGame() {
            if (gameState.gameLoop) {
                clearInterval(gameState.gameLoop);
                gameState.gameLoop = null;
            }
            gameState.gameStarted = false;
        }

        function nextLevel() {
            gameState.level++;
            gameState.levelComplete = false;
            levelEl.textContent = gameState.level;
            hideMessage();
            
            initLevel(gameState.level);
            drawGame();
            
            gameState.gameStarted = true;
            gameState.gameLoop = setInterval(updateGame, gameState.ghostSpeed);
        }

        function updateLives() {
            livesEl.textContent = '‚ù§Ô∏è'.repeat(gameState.lives);
        }

        function showMessage(type) {
            messageEl.classList.remove('hidden', 'level-complete', 'game-over', 'instructions');
            
            if (type === 'level-complete') {
                messageEl.classList.add('level-complete');
                messageEl.innerHTML = `
                    <div class="message-title" style="color: #4ade80">NIVEAU TERMIN√â!</div>
                    <div class="message-text" style="color: white; font-size: 1.125rem">Score: ${gameState.score}</div>
                `;
                startBtn.textContent = 'NIVEAU SUIVANT ‚ûú';
                startBtn.onclick = nextLevel;
                startBtn.classList.remove('hidden');
            } else if (type === 'game-over') {
                messageEl.classList.add('game-over');
                messageEl.innerHTML = `
                    <div class="message-title" style="color: #f87171">GAME OVER!</div>
                    <div class="message-text" style="color: white; font-size: 1.125rem">Score: ${gameState.score}</div>
                    <div class="message-text" style="color: #d1d5db">Niveau: ${gameState.level}</div>
                `;
                startBtn.textContent = 'üîÑ REJOUER';
                startBtn.onclick = startGame;
                startBtn.classList.remove('hidden');
            }
        }

        function hideMessage() {
            messageEl.classList.add('hidden');
        }

        function setDirection(dir) {
            if (gameState.gameStarted) {
                gameState.pacman.nextDirection = dir;
            }
        }

        startBtn.onclick = startGame;

        document.querySelectorAll('.control-btn').forEach(btn => {
            btn.addEventListener('pointerdown', (e) => {
                e.preventDefault();
                setDirection(btn.dataset.dir);
            });
        });

        document.addEventListener('keydown', (e) => {
            if (!gameState.gameStarted) return;
            switch(e.key) {
                case 'ArrowUp':
                    e.preventDefault();
                    setDirection('up');
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    setDirection('down');
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    setDirection('left');
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    setDirection('right');
                    break;
            }
        });

        messageEl.innerHTML = `
            <div class="message-text" style="color: white; margin-bottom: 8px">üéÆ 10 niveaux progressifs!</div>
            <div class="message-text" style="color: #d1d5db; margin-bottom: 4px">‚ö™ Gros points = Power-up!</div>
            <div class="message-text" style="color: #9ca3af; font-size: 0.75rem">üí© deviennent comestibles</div>
        `;
        messageEl.classList.remove('hidden');
        messageEl.classList.add('instructions');

        drawGame();
    </script>
</body>
</html>
